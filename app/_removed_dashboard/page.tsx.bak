"use client";

import { SiteHeader } from "@/components/site-header";
import { useAuth } from "@/lib/auth/hooks";
import { Loader2 } from "lucide-react";
import { Metadata } from "next";
import { redirect } from "next/navigation";

export const metadata: Metadata = {
  title: "Dashboard | Buildappswith",
  description: "Your Buildappswith dashboard",
};

export default function DashboardPage() {
  const { user, isLoading, isAuthenticated } = useAuth();

  // Redirect to login if not authenticated
  if (!isLoading && !isAuthenticated) {
    redirect("/login");
  }

  if (isLoading) {
    return (
      <div className="flex h-screen w-screen items-center justify-center">
        <Loader2 className="h-8 w-8 animate-spin" />
      </div>
    );
  }

  return (
    <div className="flex min-h-screen flex-col">
      <SiteHeader />
      <main className="flex-1 pt-16">
        <div className="container py-12">
          <h1 className="text-3xl font-bold mb-6">Dashboard</h1>
          <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            <div className="rounded-lg border p-6 shadow-sm">
              <h2 className="text-xl font-semibold mb-4">Welcome, {user?.name || user?.email}</h2>
              <p className="text-slate-500 dark:text-slate-400">
                Your role: <span className="font-medium capitalize">{user?.role}</span>
              </p>
              <p className="text-slate-500 dark:text-slate-400 mt-2">
                Email: {user?.email}
              </p>
            </div>
            
            <div className="rounded-lg border p-6 shadow-sm">
              <h2 className="text-xl font-semibold mb-4">Quick Actions</h2>
              <ul className="space-y-2">
                <li>
                  <a href="/profile" className="text-blue-600 dark:text-blue-400 hover:underline">
                    View Profile
                  </a>
                </li>
                <li>
                  <a href="/bookings" className="text-blue-600 dark:text-blue-400 hover:underline">
                    Manage Bookings
                  </a>
                </li>
                {user?.role === "builder" && (
                  <li>
                    <a href="/builder-dashboard" className="text-blue-600 dark:text-blue-400 hover:underline">
                      Builder Dashboard
                    </a>
                  </li>
                )}
                {user?.role === "client" && (
                  <li>
                    <a href="/client-dashboard" className="text-blue-600 dark:text-blue-400 hover:underline">
                      My Projects
                    </a>
                  </li>
                )}
                {user?.role === "admin" && (
                  <li>
                    <a href="/admin" className="text-blue-600 dark:text-blue-400 hover:underline">
                      Admin Panel
                    </a>
                  </li>
                )}
              </ul>
            </div>
            
            <div className="rounded-lg border p-6 shadow-sm">
              <h2 className="text-xl font-semibold mb-4">Account Status</h2>
              <div className="flex items-center mb-2">
                <div className={`w-3 h-3 rounded-full mr-2 ${user?.verified ? "bg-green-500" : "bg-yellow-500"}`} />
                <span>{user?.verified ? "Verified Account" : "Verification Pending"}</span>
              </div>
              {user?.stripeCustomerId && (
                <p className="text-slate-500 dark:text-slate-400 mt-2">
                  Payment account: Connected
                </p>
              )}
            </div>
          </div>
        </div>
      </main>
    </div>
  );
}
